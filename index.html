<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¸©åœ°é›·</title>
<style>
  :root{
    --bg:#FFF8DC;
    --text:#2F4F4F;
    --primary:#FF6B6B;
    --secondary:#FFD93D;
    --line:#8B4513;
    --line-strong:#654321;
    --hidden:#FFEAA7;
    --revealed:#FFF;
    --flag:#FFB6C1;
    --mine-bg:#FF6B6B;
    --btn-bg:#FF6B6B;
    --btn-hover:#FF8787;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    background:linear-gradient(135deg, #FFF8DC 0%, #FFE4B5 100%);
    color:var(--text);
    font-family:"Comic Sans MS","Marker Felt",cursive,"Noto Sans TC",sans-serif;
    display:flex;align-items:center;justify-content:center;padding:16px;
  }
  .app{width:min(940px,96vw);display:grid;gap:16px;grid-template-columns:1fr}
  .topbar{
    background:#fff;border:4px solid var(--line);border-radius:20px;padding:16px;
    box-shadow:6px 6px 0 rgba(0,0,0,0.2);
  }
  h1{
    font-size:28px;color:var(--primary);text-align:center;
    text-shadow:3px 3px 0 var(--secondary);margin-bottom:12px;
    letter-spacing:2px;
  }
  .ctrls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  button{
    background:var(--btn-bg);color:#fff;border:3px solid var(--line);
    border-radius:15px;padding:10px 20px;cursor:pointer;font-weight:900;
    font-size:14px;font-family:inherit;
    box-shadow:4px 4px 0 rgba(0,0,0,0.2);
    transition:all 0.1s;
  }
  button:hover{background:var(--btn-hover);transform:translate(-2px,-2px);box-shadow:6px 6px 0 rgba(0,0,0,0.2)}
  button:active{transform:translate(2px,2px);box-shadow:2px 2px 0 rgba(0,0,0,0.2)}
  button.secondary{background:var(--secondary);color:var(--text)}
  .toolbar{
    background:#fff;border:4px solid var(--line);border-radius:20px;padding:16px;
    box-shadow:6px 6px 0 rgba(0,0,0,0.2);
    display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(120px,1fr))
  }
  .group{display:flex;flex-direction:column;gap:6px}
  .group label{font-size:13px;font-weight:700;color:var(--text)}
  select,input[type="number"]{
    background:#fff;color:var(--text);border:3px solid var(--line);
    border-radius:10px;padding:8px;outline:none;width:100%;
    font-family:inherit;font-weight:700;
  }
  .status{
    background:#fff;border:4px solid var(--line);border-radius:20px;padding:16px;
    box-shadow:6px 6px 0 rgba(0,0,0,0.2);
    display:flex;justify-content:space-around;align-items:center;gap:12px;flex-wrap:wrap
  }
  .stat{
    display:flex;align-items:center;gap:8px;font-size:16px;font-weight:800;
    color:var(--text);
  }
  .stat .val{color:var(--primary);font-size:20px}
  .grid-wrap{
    background:#fff;border:6px solid var(--line-strong);border-radius:15px;
    padding:8px;box-shadow:8px 8px 0 rgba(0,0,0,0.2);
    display:inline-block;margin:0 auto;
  }
  #board{display:grid;gap:0;width:100%}
  .cell{
    user-select:none;-webkit-user-select:none;touch-action:manipulation;
    width:38px;height:38px;display:flex;align-items:center;justify-content:center;
    background:var(--hidden);
    border:2px solid var(--line);
    font-weight:900;cursor:pointer;
    transition:all 0.15s;
    font-size:18px;color:#000;
    box-shadow:inset 2px 2px 4px rgba(0,0,0,0.1);
  }
  .cell:hover{transform:scale(1.05);z-index:10}
  .cell.revealed{background:var(--revealed);box-shadow:inset 1px 1px 3px rgba(0,0,0,0.15)}
  .cell.flag{background:var(--flag)}
  .cell.mine.revealed{background:var(--mine-bg)}
  .foot{
    text-align:center;font-size:13px;color:var(--text);
    font-weight:700;opacity:0.8;
  }
  @media (max-width:1024px){
    .app{width:98vw}
    .toolbar{grid-template-columns:repeat(3,1fr)}
  }
  @media (max-width:768px){
    body{padding:8px}
    .app{width:100vw;gap:12px}
    h1{font-size:20px;margin-bottom:8px}
    .topbar,.toolbar,.status{padding:12px;border-width:3px}
    .toolbar{grid-template-columns:repeat(2,1fr);gap:10px}
    .group label{font-size:12px}
    select,input[type="number"]{padding:6px;font-size:14px}
    button{padding:8px 16px;font-size:13px}
    .status{flex-direction:column;gap:8px;padding:10px}
    .stat{font-size:14px}
    .stat .val{font-size:18px}
    .grid-wrap{border-width:4px;padding:4px}
    .cell{width:32px;height:32px;font-size:16px;border-width:1.5px}
    .foot{font-size:11px;padding:0 8px}
  }
  @media (max-width:480px){
    h1{font-size:18px}
    .topbar,.toolbar,.status{padding:10px}
    .toolbar{grid-template-columns:1fr;gap:8px}
    button{padding:6px 12px;font-size:12px}
    .ctrls{gap:6px}
    .status{gap:6px}
    .stat{font-size:13px}
    .stat .val{font-size:16px}
    .cell{width:28px;height:28px;font-size:14px;border-width:1px}
    .grid-wrap{padding:2px;border-width:3px}
    .foot{font-size:10px}
  }
  @media (min-width:1200px){
    .app{width:1100px}
    .cell{width:42px;height:42px;font-size:20px}
  }
</style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <h1>ğŸ¨ è¸©åœ°é›· â€” è Ÿç­†å°æ–°é¢¨æ ¼ ğŸ–ï¸</h1>
      <div class="ctrls">
        <button id="btn-new">ğŸ†• æ–°å±€ (N)</button>
        <button id="btn-clear" class="secondary">ğŸš© æ¸…é™¤æ——æ¨™</button>
        <button id="btn-retry" class="secondary">ğŸ”„ é‡ä¾† (R)</button>
      </div>
    </div>

    <div class="toolbar">
      <div class="group">
        <label>ğŸ¯ é›£åº¦</label>
        <select id="preset">
          <option value="beginner">åˆç´š 9Ã—9 / 10 é›·</option>
          <option value="intermediate">ä¸­ç´š 16Ã—16 / 40 é›·</option>
          <option value="expert">é«˜ç´š 30Ã—16 / 99 é›·</option>
          <option value="custom">è‡ªè¨‚</option>
        </select>
      </div>
      <div class="group">
        <label>ğŸ“ åˆ—</label>
        <input type="number" id="rows" min="5" max="50" value="9">
      </div>
      <div class="group">
        <label>ğŸ“ è¡Œ</label>
        <input type="number" id="cols" min="5" max="50" value="9">
      </div>
      <div class="group">
        <label>ğŸ’£ åœ°é›·</label>
        <input type="number" id="mines" min="1" max="600" value="10">
      </div>
      <div class="group">
        <label>ğŸ“¦ å­å€é«˜</label>
        <input type="number" id="subRows" min="1" max="10" value="3">
      </div>
      <div class="group">
        <label>ğŸ“¦ å­å€å¯¬</label>
        <input type="number" id="subCols" min="1" max="10" value="3">
      </div>
    </div>

    <div class="status">
      <div class="stat">â±ï¸ <span id="time" class="val">000</span>ç§’</div>
      <div class="stat">ğŸ’£ <span id="bombs" class="val">010</span>é›·</div>
      <div class="stat">ğŸ“¦ <span id="hidden" class="val">081</span>æ ¼</div>
      <div class="stat">ğŸ¯ <span id="state" class="val">ç­‰å¾…é¦–æ“Š</span></div>
    </div>

    <div style="display:flex;justify-content:center">
      <div class="grid-wrap">
        <div id="board" aria-label="Minesweeper board"></div>
      </div>
    </div>
    <div class="foot">å·¦éµç¿»æ ¼ Â· å³éµæ’æ—— Â· é›™æ“Šæ•¸å­—å¿«é€Ÿå±•é–‹ ğŸ®</div>
  </div>

<script>
(()=>{
const $=s=>document.querySelector(s);
const fmt3=n=>String(n).padStart(3,'0');
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

let rows=9,cols=9,mines=10,subRows=3,subCols=3;
let board=[],firstClick=true,started=false,timer=null,seconds=0;
let flags=0,hiddenCount=0,alive=true,won=false;
let safeArea=true,chordEnabled=true;

const elBoard=$('#board'),elTime=$('#time'),elBombs=$('#bombs'),elHidden=$('#hidden'),elState=$('#state');

function setPreset(name){
  if(name==='beginner'){rows=9;cols=9;mines=10;subRows=3;subCols=3}
  else if(name==='intermediate'){rows=16;cols=16;mines=40;subRows=4;subCols=4}
  else if(name==='expert'){rows=16;cols=30;mines=99;subRows=4;subCols=5}
  $('#rows').value=rows;$('#cols').value=cols;$('#mines').value=mines;
  $('#subRows').value=subRows;$('#subCols').value=subCols;
}

function newGame(){
  const preset=$('#preset').value;
  if(preset!=='custom')setPreset(preset);
  rows=clamp(parseInt($('#rows').value||9),5,50);
  cols=clamp(parseInt($('#cols').value||9),5,50);
  const maxMines=rows*cols-1;
  mines=clamp(parseInt($('#mines').value||10),1,Math.min(600,maxMines));
  subRows=clamp(parseInt($('#subRows').value||3),1,10);
  subCols=clamp(parseInt($('#subCols').value||3),1,10);
  safeArea=true;chordEnabled=true;

  board=[];firstClick=true;started=false;seconds=0;flags=0;alive=true;won=false;
  clearInterval(timer);elTime.textContent=fmt3(seconds);

  elBoard.style.gridTemplateColumns=`repeat(${cols},1fr)`;
  elBoard.innerHTML='';
  hiddenCount=rows*cols;

  for(let r=0;r<rows;r++){
    const row=[];
    for(let c=0;c<cols;c++){
      row.push({r,c,mine:false,adj:0,revealed:false,flag:false,dom:null});
    }
    board.push(row);
  }
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const div=document.createElement('button');
      div.className='cell';
      div.setAttribute('data-r',r);
      div.setAttribute('data-c',c);
      div.setAttribute('aria-label','hidden');



      div.addEventListener('mousedown',onMouseDown);
      div.addEventListener('contextmenu',e=>e.preventDefault());
      div.addEventListener('dblclick',onDblClick);
      attachLongPress(div,()=>toggleFlag(r,c),()=>reveal(r,c));

      elBoard.appendChild(div);
      board[r][c].dom=div;
    }
  }
  updateHUD('ç­‰å¾…é¦–æ“Š');
  refreshCounts();
}

function attachLongPress(el,onLong,onTap){
  let t=null,moved=false;
  el.addEventListener('touchstart',()=>{moved=false;t=setTimeout(()=>{onLong();t=null},500)},{passive:true});
  el.addEventListener('touchmove',()=>{moved=true;if(t){clearTimeout(t);t=null}},{passive:true});
  el.addEventListener('touchend',()=>{if(t){clearTimeout(t);t=null;if(!moved)onTap()}});
}

function onMouseDown(e){
  if(!alive||won)return;
  const r=+this.dataset.r,c=+this.dataset.c;
  if(e.button===2){e.preventDefault();toggleFlag(r,c)}
  else if(e.button===0){
    if(e.buttons===3&&chordEnabled){chord(r,c)}
    else{reveal(r,c)}
  }
}
function onDblClick(e){
  if(!alive||won||!chordEnabled)return;
  const r=+this.dataset.r,c=+this.dataset.c;
  chord(r,c);
}

function placeMines(excludeSet){
  let placed=0;
  while(placed<mines){
    const idx=(Math.random()*rows*cols)|0;
    const r=(idx/cols)|0,c=idx%cols;
    const key=r+','+c;
    if(excludeSet.has(key))continue;
    const cell=board[r][c];
    if(!cell.mine){cell.mine=true;placed++}
  }
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      board[r][c].adj=neighbors(r,c).filter(n=>n.mine).length;
    }
  }
}

function neighbors(r,c){
  const list=[];
  for(let dr=-1;dr<=1;dr++){
    for(let dc=-1;dc<=1;dc++){
      if(dr===0&&dc===0)continue;
      const nr=r+dr,nc=c+dc;
      if(nr>=0&&nr<rows&&nc>=0&&nc<cols)list.push(board[nr][nc]);
    }
  }
  return list;
}

function startTimer(){
  if(started)return;
  started=true;
  timer=setInterval(()=>{seconds++;elTime.textContent=fmt3(seconds)},1000);
}

function reveal(r,c){
  const cell=board[r][c];
  if(cell.revealed||cell.flag)return;
  if(firstClick){
    firstClick=false;
    const exclude=new Set();
    exclude.add(r+','+c);
    if(safeArea){neighbors(r,c).forEach(n=>exclude.add(n.r+','+n.c))}
    placeMines(exclude);
    startTimer();
  }
  if(cell.mine){lose(cell);return}
  floodReveal(r,c);
  checkWin();
}

function floodReveal(r,c){
  const q=[[r,c]];
  while(q.length){
    const[rr,cc]=q.shift();
    const cur=board[rr][cc];
    if(cur.revealed||cur.flag)continue;
    cur.revealed=true;hiddenCount--;
    paint(cur);
    if(cur.adj===0){
      neighbors(rr,cc).forEach(n=>{if(!n.revealed&&!n.flag)q.push([n.r,n.c])});
    }
  }
  refreshCounts();
}

function toggleFlag(r,c){
  const cell=board[r][c];
  if(cell.revealed)return;
  cell.flag=!cell.flag;
  flags+=cell.flag?1:-1;
  paint(cell);
  refreshCounts();
}

function chord(r,c){
  const cell=board[r][c];
  if(!cell.revealed)return;
  const neigh=neighbors(r,c);
  const flagCount=neigh.filter(n=>n.flag).length;
  if(flagCount===cell.adj){
    neigh.forEach(n=>{
      if(!n.revealed&&!n.flag){
        if(n.mine){lose(n)}else floodReveal(n.r,n.c)
      }
    });
    checkWin();
  }
}

function checkWin(){
  if(!alive)return;
  const safeCells=rows*cols-mines;
  const revealed=safeCells-(hiddenCount-mines);
  if(revealed>=safeCells){win()}
}

function win(){
  won=true;alive=false;clearInterval(timer);
  elState.textContent='ğŸ‰ å‹åˆ©ï¼';
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    const cell=board[r][c];
    if(cell.mine&&!cell.flag){cell.flag=true;flags++;paint(cell)}
  }
  refreshCounts();
}

function lose(triggerCell){
  alive=false;clearInterval(timer);
  elState.textContent='ğŸ’¥ è¸©é›·äº†';
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    const cell=board[r][c];
    if(cell.mine){cell.revealed=true;paint(cell)}
  }
  triggerCell.dom.style.outline='4px solid var(--primary)';
}

function paint(cell){
  const el=cell.dom;
  el.className='cell'+(cell.revealed?' revealed':'')+(cell.flag?' flag':'')+(cell.mine?' mine':'');
  if(cell.revealed){
    if(cell.mine){
      el.textContent='ğŸ’£';el.setAttribute('aria-label','mine');
    }else{
      el.textContent=cell.adj===0?'':cell.adj;
      el.setAttribute('aria-label','revealed '+cell.adj);
    }
  }else{
    el.textContent=cell.flag?'ğŸš©':'';
    el.setAttribute('aria-label',cell.flag?'flag':'hidden');
  }
}

function refreshCounts(){
  elBombs.textContent=fmt3(Math.max(mines-flags,0));
  elHidden.textContent=fmt3(hiddenCount);
}
function updateHUD(msg){
  elState.textContent=msg||'';
  elTime.textContent=fmt3(seconds);
  elBombs.textContent=fmt3(mines-flags);
  elHidden.textContent=fmt3(hiddenCount);
}

$('#btn-new').addEventListener('click',newGame);
$('#btn-clear').addEventListener('click',()=>{
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    const cell=board[r][c];
    if(!cell.revealed&&cell.flag){cell.flag=false;flags--;paint(cell)}
  }
  refreshCounts();
});
$('#btn-retry').addEventListener('click',()=>newGame());
$('#preset').addEventListener('change',e=>{if(e.target.value!=='custom'){setPreset(e.target.value)}});
document.addEventListener('keydown',e=>{
  if(e.key==='N'||e.key==='n')newGame();
  if(e.key==='R'||e.key==='r')newGame();
});

setPreset('beginner');
newGame();
})();
</script>
</body>
</html>

